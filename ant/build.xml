<?xml version="1.0"?>

<project name="com.tapsterrock.mpx" default="archive" basedir="..">

<target name="init" depends="init-props,init-dirs">
   <tstamp/>
</target>

<target name="init-props" description="Initialize properties">
   <tstamp/>
   <property name="docdir" value="${basedir}/doc/api" />
   <property name="antdir" value="${basedir}/ant" />
   <property name="srcdir" value="${basedir}/src" />
   <property name="poilib" value="${basedir}/lib/jakarta-poi-1.5.1.jar" />
   <property name="jaxbdir" value="c:\java\jaxb-1.0-beta" />
   <property name="jaxblibs" value="${jaxbdir}/lib/jaxb-api.jar:${jaxbdir}/lib/jaxb-ri.jar:${jaxbdir}/lib/jaxb-libs.jar" />
   <property name="mspdi.xsd" value="c:\tapsterrock\docs\msp\mspdi.xsd"/>
   <property name="jbuilder" value="${basedir}/jbuilder" />
   <property name="classes" value="${basedir}/classes" />
   <property name="bak" value="${basedir}/bak" />
   <property name="junitdir" value="${basedir}/junit" />
   <property name="junitclasses" value="${junitdir}/classes" />
   <property name="junitbak" value="${junitdir}/bak" />
   <property name="examples.dir" value="${basedir}/examples" />
   <property name="examples.classes" value="${examples.dir}/classes" />
   <property name="distribution" value="${basedir}/../mpxj.zip" />
   <property name="schemadir" value="/com/tapsterrock/mspdi/schema" />
</target>


<target name="init-dirs" depends="init-props" description="Initialize directories">
   <mkdir dir="${classes}"/>
   <mkdir dir="${junitclasses}"/>
   <mkdir dir="${examples.classes}"/>
</target>

<target name="xjc" depends="init" description="Rebuild source generated by JAXB">
   <exec executable="${jaxbdir}/bin/xjc.bat">
	<arg line="-d ${srcdir} -p com.tapsterrock.mspdi.schema ${mspdi.xsd}" />
   </exec>	
</target>

<target name="compile" depends="init" description="Compile everything">
   <javac srcdir="${basedir}/src" destdir="${classes}" classpath="${classpath}:${poilib}:${jaxblibs}" debug="on" />
   <javac srcdir="${junitdir}/src" destdir="${junitclasses}" classpath="${classpath}:${classes}:${junitdir}/junit.jar" debug="on" />
   <copy file="${basedir}/src${schemadir}/bgm.ser" todir="${classes}${schemadir}"/>
   <copy file="${basedir}/src${schemadir}/jaxb.properties" todir="${classes}${schemadir}"/>
   <javac srcdir="${examples.dir}" destdir="${examples.classes}" classpath="${classpath}:${classes}" debug="on" />
</target>

<target name="document" depends="init-props" description="Generate documentation">
   <mkdir dir="${docdir}"/>
   <javadoc 
	sourcepath="${basedir}/src"
	classpath="${classpath}:${poilib}:${jaxblibs}"
      packagenames="com.tapsterrock.mpx.*,com.tapsterrock.mpp.*,com.tapsterrock.mspdi.*,com.tapsterrock.utility.*"
      destdir="${docdir}"
      verbose="no"
      access="public">
   </javadoc>
</target>

<target name="archive" depends="compile" description="Create JAR files">
   <jar jarfile="${basedir}/mpxj.jar" basedir="${classes}"/>
   <jar jarfile="${junitdir}/mpxjtest.jar" basedir="${junitclasses}"/>
</target>

<target name="distribute" depends="compile,archive,document,clean-classes" description="Create distribution">
   <zip zipfile="${distribution}">
      <zipfileset dir="${basedir}" prefix="mpxj" excludes="**/CVSROOT/*,**/CVS/*"/>
   </zip>
</target>

<target name="clean-temp" depends="init-props" description="Clean up temporary files">
   <delete dir="${bak}"/>
   <delete dir="${junitbak}"/>
   <delete>
      <fileset dir="${basedir}" includes="**/*~" defaultexcludes="no"/>
   </delete>
   <delete>
      <fileset dir="${jbuilder}" includes="**/*.local" />
   </delete>
</target>

<target name="clean-classes" depends="init-props" description="Clean up class files">
   <delete dir="${classes}"/>
   <delete dir="${junitclasses}"/>
   <delete dir="${examples.classes}"/>
</target>

<target name="clean" depends="init-props, clean-temp, clean-classes" description="">
   <delete file="${basedir}/mpxj.jar"/>
   <delete file="${junitdir}/mpxjtest.jar"/>
   <delete dir="${docdir}"/>
</target>

</project>
